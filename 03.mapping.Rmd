---
title: "03.mapping"
author: "Guillaume Papuga"
date: "`r Sys.Date()`"
output: html_document
---


# Build a mask for permanent water and associated mixels
```{r build a mask}
# Select all cells that represent permanent water
## threshold = 360 days
hydro.c = mask(hydroperiod.93, p.bound) %>%
  crop (p.bound)
hydro.360 = reclassify (hydro.c, # the raster to be reclassified
                        matrix(c(0, 330, NA, 330, 367, 1, 367, 450, NA), ncol=3, byrow=TRUE))
## change to Polygon
hydro.360.v = rasterToPolygons(hydro.360, 
                               n=4, 
                               na.rm=TRUE, 
                               digits=12, 
                               dissolve=TRUE)

# Delete all permanent water lying inside our presence lagoon
## There must be few but still we can have some artifacts


# Draw a buffer of 40m (= 2 pixels) at the limit of permanent water
## S4 method for signature 'RasterLayer'
hydro.buf = buffer(hydro.360, 
                   width=50, # numeric, include just more than one pixel
                   doEdge = TRUE, # logical, the boundaries function is called first
                   dissolve = TRUE) # dissolve the result

```


# Write raster
```{r}
# 5. save the map
writeRaster(x = pred.glm, 
            filename = "/home/papuga/Documents/couches_lag.temp/raw.layers/raw.res/test.pred.glm.crop.tif",
            overwrite=TRUE)
```
